/**
 * ByteBuffer v0.0.1
 * Copyright (c) 2012 Tim Kurvers <http://moonsphere.net>
 *
 * Wrapper for ArrayBuffer/DataView maintaining index and default endianness.
 * Supports arbitrary reading/writing, automatic growth, clipping, cloning and
 * reversing as well as UTF-8 characters and NULL-terminated C-strings.
 *
 * The contents of this file are subject to the MIT License, under which
 * this library is licensed. See the LICENSE file for the full license.
 */
var ByteBuffer;ByteBuffer=function(){function g(b,c){var d;b==null&&(b=0),c==null&&(c=this.constructor.BIG_ENDIAN),this._buffer=null,this._raw=null,this._view=null,this._order=c,this._index=0,d=a(b,!0),d||(d=new ArrayBuffer(b)),this._setup(d)}"use strict";var a,b,c,d,e,f=this;return g.LITTLE_ENDIAN=!0,g.BIG_ENDIAN=!1,b=function(a,b){return Object.defineProperty(g.prototype,a,{get:b,enumerable:!0,configurable:!0})},d=function(a,b){return Object.defineProperty(g.prototype,a,{set:b,enumerable:!0,configurable:!0})},g.prototype._setup=function(a){return this._buffer=a,this._raw=new Uint8Array(this._buffer),this._view=new DataView(this._buffer)},g.prototype._sanitizeIndex=function(){this._index<0&&(this._index=0);if(this._index>this.length)return this._index=this.length},a=function(a,b){b==null&&(b=!1);if(a.byteLength!=null)return a.buffer!=null?b?a.buffer.slice(0):a.buffer:b?a.slice(0):a;if(a.length==null)return null;try{return(new Uint8Array(a)).buffer}catch(c){return null}},b("buffer",function(){return this._buffer}),b("view",function(){return this._view}),b("length",function(){return this._buffer.byteLength}),b("byteLength",function(){return this.length}),b("order",function(){return this._order}),d("order",function(a){return this._order=!!a}),b("index",function(){return this._index}),d("index",function(a){if(a<0||a>this.length)throw new RangeError("Invalid index "+a+", should be between 0 and "+this.length);return this._index=a}),g.prototype.front=function(){return this._index=0,this},g.prototype.end=function(){return this._index=this.length,this},g.prototype.seek=function(a){return a==null&&(a=1),this.index+=a,this},b("available",function(){return this.length-this._index}),c=function(a,b){return function(c){var d;c==null&&(c=this._order);if(b>this.available)throw new Error("Cannot read "+b+" byte(s), "+this.available+" available");return d=this._view[a](this._index,c),this._index+=b,d}},e=function(a,b){return function(c,d){d==null&&(d=this._order);if(b>this.available)throw new Error("Cannot write "+c+" using "+b+" byte(s), "+this.available+" available");return this._view[a](this._index,c,d),this._index+=b,this}},g.prototype.readByte=c("getInt8",1),g.prototype.readUnsignedByte=c("getUint8",1),g.prototype.readShort=c("getInt16",2),g.prototype.readUnsignedShort=c("getUint16",2),g.prototype.readInt=c("getInt32",4),g.prototype.readUnsignedInt=c("getUint32",4),g.prototype.readFloat=c("getFloat32",4),g.prototype.readDouble=c("getFloat64",8),g.prototype.writeByte=e("setInt8",1),g.prototype.writeUnsignedByte=e("setUint8",1),g.prototype.writeShort=e("setInt16",2),g.prototype.writeUnsignedShort=e("setUint16",2),g.prototype.writeInt=e("setInt32",4),g.prototype.writeUnsignedInt=e("setUint32",4),g.prototype.writeFloat=e("setFloat32",4),g.prototype.writeDouble=e("setFloat64",8),g.prototype.read=function(a){var b;a==null&&(a=this.available);if(a>this.available)throw new Error("Cannot read "+a+" byte(s), "+this.available+" available");if(a<=0)throw new RangeError("Invalid number of bytes "+a);return b=new this.constructor(this._buffer.slice(this._index,this._index+a)),this._index+=a,b},g.prototype.write=function(b){var c;if(!(b instanceof Uint8Array)){c=a(b);if(!c)throw new TypeError("Cannot write "+b+", not a sequence");b=new Uint8Array(c)}if(b.byteLength>this.available)throw new Error("Cannot write "+b+" using "+b.byteLength+" byte(s), "+this.available+" available");return this._raw.set(b,this._index),this._index+=b.byteLength,this},g.prototype.readString=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;a==null&&(a=this.available);if(a>this.available)throw new Error("Cannot read "+a+" byte(s), "+this.available+" available");if(a<=0)throw new RangeError("Invalid number of bytes "+a);m=this._raw,h=[],f=0,b=c=d=e=null,n=this._index+a;while(this._index<n){b=m[this._index];if(b<128)h[f++]=b,this._index++;else{if(b<194)throw new Error("Unexpected continuation byte");if(b<224){c=m[this._index+1];if(c<128||c>191)throw new Error("Bad continuation byte");h[f++]=((b&31)<<6)+(c&63),this._index+=2}else if(b<240){c=m[this._index+1];if(c<128||c>191)throw new Error("Bad continuation byte");d=m[this._index+2];if(d<128||d>191)throw new Error("Bad continuation byte");h[f++]=((b&15)<<12)+((c&63)<<6)+(d&63),this._index+=3}else{if(!(b<245))throw new Error("Illegal byte");c=m[this._index+1];if(c<128||c>191)throw new Error("Bad continuation byte");d=m[this._index+2];if(d<128||d>191)throw new Error("Bad continuation byte");e=m[this._index+3];if(e<128||e>191)throw new Error("Bad continuation byte");i=((b&7)<<18)+((c&63)<<12)+((d&63)<<6)+(e&63),i-=65536,h[f++]=55296+((i&1047552)>>>10),h[f++]=56320+(i&1023),this._index+=4}}}l=65536,k=h.length;if(k<l)return String.fromCharCode.apply(String,h);g=[],j=0;while(j<k)g.push(String.fromCharCode.apply(String,h.slice(j,j+l))),j+=l;return g.join("")},g.prototype.writeString=function(a){var b,c,d,e,f,g,h;c=[],h=a.length,g=0,b=0;while(g<h){d=a.charCodeAt(g);if(d<=127)c[b++]=d;else if(d<=2047)c[b++]=192|(d&1984)>>>6,c[b++]=128|d&63;else if(d<=55295||d>=57344&&d<=65535)c[b++]=224|(d&61440)>>>12,c[b++]=128|(d&4032)>>>6,c[b++]=128|d&63;else{if(g===h-1)throw new Error("Unpaired surrogate "+a[g]+" (index "+g+")");f=a.charCodeAt(++g);if(d<55296||d>56319||f<56320||f>57343)throw new Error("Unpaired surrogate "+a[g]+" (index "+g+")");e=((d&1023)<<10)+(f&1023)+65536,c[b++]=240|(e&1835008)>>>18,c[b++]=128|(e&258048)>>>12,c[b++]=128|(e&4032)>>>6,c[b++]=128|e&63}++g}return this.write(c),c.length},g.prototype.readUTFChars=g.prototype.readString,g.prototype.writeUTFChars=g.prototype.writeString,g.prototype.readCString=function(){var a,b,c,d;a=this._raw,c=a.length,b=this._index;while(a[b]!==0&&b<c)++b;return c=b-this._index,c>0?(d=this.readString(c),this.readByte(),d):null},g.prototype.writeCString=function(a){var b;return b=this.writeString(a),this.writeByte(0),++b},g.prototype.clip=function(a,b){var c;return a==null&&(a=this._index),b==null&&(b=this.length),a<0&&(a=this.length+a),c=this._buffer.slice(a,b),this._setup(c),this._index-=a,this._sanitizeIndex(),this},g.prototype.clone=function(){var a;return a=new this.constructor(this._buffer.slice(0)),a.index=this._index,a},g.prototype.reverse=function(){return Array.prototype.reverse.call(this._raw),this._index=0,this},g.prototype.toArray=function(){return Array.prototype.slice.call(this._raw,0)},g.prototype.toString=function(){var a;return a=this._order===this.constructor.BIG_ENDIAN?"big-endian":"little-endian","[ByteBuffer; Order: "+a+"; Length: "+this.length+"; Index: "+this._index+"; Available: "+this.available+"]"},g.prototype.toHex=function(a){return a==null&&(a=" "),Array.prototype.map.call(this._raw,function(a){return("  "+a.toString(16).toUpperCase()).slice(-2)}).join(a)},g.prototype.toASCII=function(a,b){var c;return a==null&&(a=" "),b==null&&(b=!0),c=b?" ":"",Array.prototype.map.call(this._raw,function(a){return a<32||a>126?c+"?":c+String.fromCharCode(a)}).join(a)},g}.call(this);