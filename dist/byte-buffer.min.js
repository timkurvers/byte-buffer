/**
 * ByteBuffer v0.0.1
 * Copyright (c) 2012 Tim Kurvers <http://moonsphere.net>
 *
 * Wrapper for ArrayBuffer/DataView maintaining index and default endianness.
 * Supports arbitrary reading/writing, automatic growth, clipping, cloning and
 * reversing as well as UTF-8 characters and NULL-terminated C-strings.
 *
 * The contents of this file are subject to the MIT License, under which
 * this library is licensed. See the LICENSE file for the full license.
 */
var ByteBuffer;ByteBuffer=function(){function h(b,c){var e;b==null&&(b=0),c==null&&(c=d.BIG_ENDIAN),this._buffer=null,this._raw=null,this._view=null,this._order=c,this._index=0,e=a(b,!0),e||(e=new ArrayBuffer(b)),this.buffer=e}var a,b,c,d,e,f,g=this;return h.LITTLE_ENDIAN=!0,h.BIG_ENDIAN=!1,d=h,b=function(a,b){return Object.defineProperty(h.prototype,a,{get:b,enumerable:!0,configurable:!0})},e=function(a,b){return Object.defineProperty(h.prototype,a,{set:b,enumerable:!0,configurable:!0})},h.prototype._sanitizeIndex=function(){this._index<0&&(this._index=0);if(this._index>this.length)return this._index=this.length},a=function(a,b){b==null&&(b=!1);if(a.byteLength!=null)return a.buffer!=null?b?a.buffer.slice(0):a.buffer:b?a.slice(0):a;if(a.length==null)return null;try{return(new Uint8Array(a)).buffer}catch(c){return null}},b("buffer",function(){return this._buffer}),e("buffer",function(a){return this._buffer=a,this._raw=new Uint8Array(this._buffer),this._view=new DataView(this._buffer),this._sanitizeIndex()}),b("view",function(){return this._view}),b("length",function(){return this._buffer.byteLength}),b("byteLength",function(){return this.length}),b("order",function(){return this._order}),e("order",function(a){return this._order=!!a}),b("index",function(){return this._index}),e("index",function(a){if(a<0||a>this.length)throw new RangeError("Invalid index "+a+", should be between 0 and "+this.length);return this._index=a}),h.prototype.front=function(){return this._index=0,this},h.prototype.end=function(){return this._index=this.length,this},h.prototype.seek=function(a){return a==null&&(a=1),this.index+=a,this},b("available",function(){return this.length-this._index}),c=function(a,b){return function(c){var d;c==null&&(c=this._order);if(b>this.available)throw new Error("Cannot read "+b+" byte(s), "+this.available+" available");return d=this._view[a](this._index,c),this._index+=b,d}},f=function(a,b){return function(c,d){d==null&&(d=this._order);if(b>this.available)throw new Error("Cannot write "+c+" using "+b+" byte(s), "+this.available+" available");return this._view[a](this._index,c,d),this._index+=b,this}},h.prototype.readByte=c("getInt8",1),h.prototype.readUnsignedByte=c("getUint8",1),h.prototype.readShort=c("getInt16",2),h.prototype.readUnsignedShort=c("getUint16",2),h.prototype.readInt=c("getInt32",4),h.prototype.readUnsignedInt=c("getUint32",4),h.prototype.readFloat=c("getFloat32",4),h.prototype.readDouble=c("getFloat64",8),h.prototype.writeByte=f("setInt8",1),h.prototype.writeUnsignedByte=f("setUint8",1),h.prototype.writeShort=f("setInt16",2),h.prototype.writeUnsignedShort=f("setUint16",2),h.prototype.writeInt=f("setInt32",4),h.prototype.writeUnsignedInt=f("setUint32",4),h.prototype.writeFloat=f("setFloat32",4),h.prototype.writeDouble=f("setFloat64",8),h.prototype.read=function(a){var b;a==null&&(a=this.available);if(a>this.available)throw new Error("Cannot read "+a+" byte(s), "+this.available+" available");if(a<=0)throw new RangeError("Invalid number of bytes "+a);return b=new d(this._buffer.slice(this._index,this._index+a)),this._index+=a,b},h.prototype.write=function(b){var c,d;if(b instanceof Uint8Array)d=b;else{c=a(b);if(!c)throw new TypeError("Cannot write "+b+", not a sequence");d=new Uint8Array(c)}if(d.byteLength>this.available)throw new Error("Cannot write "+b+" using "+d.byteLength+" byte(s), "+this.available+" available");return this._raw.set(d,this._index),this._index+=d.byteLength,this},h.prototype.readString=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;a==null&&(a=this.available);if(a>this.available)throw new Error("Cannot read "+a+" byte(s), "+this.available+" available");if(a<=0)throw new RangeError("Invalid number of bytes "+a);m=this._raw,h=[],f=0,b=c=d=e=null,n=this._index+a;while(this._index<n){b=m[this._index];if(b<128)h[f++]=b,this._index++;else{if(b<194)throw new Error("Unexpected continuation byte");if(b<224){c=m[this._index+1];if(c<128||c>191)throw new Error("Bad continuation byte");h[f++]=((b&31)<<6)+(c&63),this._index+=2}else if(b<240){c=m[this._index+1];if(c<128||c>191)throw new Error("Bad continuation byte");d=m[this._index+2];if(d<128||d>191)throw new Error("Bad continuation byte");h[f++]=((b&15)<<12)+((c&63)<<6)+(d&63),this._index+=3}else{if(!(b<245))throw new Error("Illegal byte");c=m[this._index+1];if(c<128||c>191)throw new Error("Bad continuation byte");d=m[this._index+2];if(d<128||d>191)throw new Error("Bad continuation byte");e=m[this._index+3];if(e<128||e>191)throw new Error("Bad continuation byte");i=((b&7)<<18)+((c&63)<<12)+((d&63)<<6)+(e&63),i-=65536,h[f++]=55296+((i&1047552)>>>10),h[f++]=56320+(i&1023),this._index+=4}}}l=65536,k=h.length;if(k<l)return String.fromCharCode.apply(String,h);g=[],j=0;while(j<k)g.push(String.fromCharCode.apply(String,h.slice(j,j+l))),j+=l;return g.join("")},h.prototype.writeString=function(a){var b,c,d,e,f,g,h;c=[],h=a.length,g=0,b=0;while(g<h){d=a.charCodeAt(g);if(d<=127)c[b++]=d;else if(d<=2047)c[b++]=192|(d&1984)>>>6,c[b++]=128|d&63;else if(d<=55295||d>=57344&&d<=65535)c[b++]=224|(d&61440)>>>12,c[b++]=128|(d&4032)>>>6,c[b++]=128|d&63;else{if(g===h-1)throw new Error("Unpaired surrogate "+a[g]+" (index "+g+")");f=a.charCodeAt(++g);if(d<55296||d>56319||f<56320||f>57343)throw new Error("Unpaired surrogate "+a[g]+" (index "+g+")");e=((d&1023)<<10)+(f&1023)+65536,c[b++]=240|(e&1835008)>>>18,c[b++]=128|(e&258048)>>>12,c[b++]=128|(e&4032)>>>6,c[b++]=128|e&63}++g}return this.write(c),c.length},h.prototype.readUTFChars=h.prototype.readString,h.prototype.writeUTFChars=h.prototype.writeString,h.prototype.readCString=function(){var a,b,c,d;a=this._raw,c=a.length,b=this._index;while(a[b]!==0&&b<c)++b;return c=b-this._index,c>0?(d=this.readString(c),this.readByte(),d):null},h.prototype.writeCString=function(a){var b;return b=this.writeString(a),this.writeByte(0),++b},h.prototype.prepend=function(a){var b;if(a<=0)throw new RangeError("Invalid number of bytes "+a);return b=new Uint8Array(this.length+a),b.set(this._raw,a),this._index+=a,this.buffer=b.buffer,this},h.prototype.append=function(a){var b;if(a<=0)throw new RangeError("Invalid number of bytes "+a);return b=new Uint8Array(this.length+a),b.set(this._raw,0),this.buffer=b.buffer,this},h.prototype.clip=function(a,b){var c;return a==null&&(a=this._index),b==null&&(b=this.length),a<0&&(a=this.length+a),c=this._buffer.slice(a,b),this._index-=a,this.buffer=c,this},h.prototype.clone=function(){var a;return a=new d(this._buffer.slice(0)),a.index=this._index,a},h.prototype.reverse=function(){return Array.prototype.reverse.call(this._raw),this._index=0,this},h.prototype.toArray=function(){return Array.prototype.slice.call(this._raw,0)},h.prototype.toString=function(){var a;return a=this._order===d.BIG_ENDIAN?"big-endian":"little-endian","[ByteBuffer; Order: "+a+"; Length: "+this.length+"; Index: "+this._index+"; Available: "+this.available+"]"},h.prototype.toHex=function(a){return a==null&&(a=" "),Array.prototype.map.call(this._raw,function(a){return("00"+a.toString(16).toUpperCase()).slice(-2)}).join(a)},h.prototype.toASCII=function(a,b,c){var d;return a==null&&(a=" "),b==null&&(b=!0),c==null&&(c="ï¿½"),d=b?" ":"",Array.prototype.map.call(this._raw,function(a){return a<32||a>126?d+c:d+String.fromCharCode(a)}).join(a)},h}.call(this);